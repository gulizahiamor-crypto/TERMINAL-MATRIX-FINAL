<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trading-Chat-IA | Sistema de Trading Inteligente</title>
    <style>
        /* ===== ESTILO MATRIX/CYBERPUNK ===== */
        @import url('https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;700&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        :root {
            --neon-green: #00ff41;
            --neon-green-dim: #00ff4133;
            --dark-bg: #0a0a0a;
            --panel-bg: #0d0d0d;
            --text-primary: #00ff41;
            --text-secondary: #00cc33;
            --text-muted: #008f11;
            --buy-color: #00ff41;
            --sell-color: #ff0040;
            --border-glow: 0 0 10px var(--neon-green), 0 0 20px var(--neon-green-dim);
        }
        
        /* Tema: Blanco y Negro */
        body.theme-bw {
            --neon-green: #000000;
            --neon-green-dim: #00000033;
            --dark-bg: #ffffff;
            --panel-bg: #f0f0f0;
            --text-primary: #000000;
            --text-secondary: #333333;
            --text-muted: #666666;
            --buy-color: #000000;
            --sell-color: #ff0000;
            --border-glow: none;
        }
        
        /* Tema: Oscuro */
        body.theme-dark {
            --neon-green: #4a9eff;
            --neon-green-dim: #4a9eff33;
            --dark-bg: #1a1a2e;
            --panel-bg: #16213e;
            --text-primary: #4a9eff;
            --text-secondary: #3d8ae6;
            --text-muted: #2a6bc4;
            --buy-color: #00ff88;
            --sell-color: #ff4a6a;
            --border-glow: 0 0 10px #4a9eff, 0 0 20px #4a9eff33;
        }
        
        /* Tema: Claro */
        body.theme-light {
            --neon-green: #0066cc;
            --neon-green-dim: #0066cc33;
            --dark-bg: #ffffff;
            --panel-bg: #f5f5f5;
            --text-primary: #000000;
            --text-secondary: #333333;
            --text-muted: #666666;
            --buy-color: #008800;
            --sell-color: #cc0000;
            --border-glow: none;
        }
        
        /* Tema: Neon Night */
        body.theme-neon {
            --neon-green: #00ffff;
            --neon-green-dim: #00ffff33;
            --dark-bg: #0a001a;
            --panel-bg: #15002a;
            --text-primary: #00ffff;
            --text-secondary: #ff00ff;
            --text-muted: #ff00ff;
            --buy-color: #00ffff;
            --sell-color: #ff00ff;
            --border-glow: 0 0 10px #00ffff, 0 0 20px #ff00ff;
        }
        
        /* Eliminar fondo matrix en temas diferentes */
        body.theme-bw::before, body.theme-dark::before, body.theme-light::before, body.theme-neon::before {
            display: none;
        }
        
        body {
            font-family: 'JetBrains Mono', monospace;
            background-color: var(--dark-bg);
            color: var(--text-primary);
            min-height: 100vh;
            overflow-x: hidden;
        }
        
        /* Efecto de fondo Matrix */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                linear-gradient(90deg, transparent 98%, var(--neon-green-dim) 100%),
                linear-gradient(0deg, transparent 98%, var(--neon-green-dim) 100%);
            background-size: 50px 50px;
            pointer-events: none;
            z-index: -1;
            opacity: 0.3;
        }
        
        /* ===== LAYOUT PRINCIPAL ===== */
        .container {
            display: grid;
            grid-template-columns: 1fr 350px;
            grid-template-rows: auto auto 1fr;
            min-height: 100vh;
            gap: 0;
        }
        
        /* ===== HEADER ===== */
        header {
            grid-column: 1 / -1;
            background: var(--panel-bg);
            border-bottom: 1px solid var(--text-primary);
            padding: 15px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: var(--border-glow);
        }
        
        .logo {
            font-size: 1.5rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 3px;
            text-shadow: var(--border-glow);
        }
        
        .logo span {
            color: var(--text-muted);
        }
        
        /* ===== PANEL DE AJUSTES ===== */
        .settings-panel {
            grid-column: 1 / -1;
            background: var(--panel-bg);
            border-bottom: 1px solid var(--text-muted);
            padding: 10px 30px;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 30px;
            flex-wrap: wrap;
        }
        
        .settings-group {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .settings-label {
            font-size: 0.75rem;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .settings-select {
            background: var(--dark-bg);
            border: 1px solid var(--text-muted);
            color: var(--text-primary);
            padding: 8px 12px;
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.8rem;
            cursor: pointer;
            min-width: 150px;
        }
        
        .settings-select:focus {
            outline: none;
            border-color: var(--text-primary);
        }
        
        .language-search {
            background: var(--dark-bg);
            border: 1px solid var(--text-muted);
            color: var(--text-primary);
            padding: 8px 12px;
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.8rem;
            width: 200px;
        }
        
        .language-search:focus {
            outline: none;
            border-color: var(--text-primary);
        }
        
        .status-indicator {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 0.8rem;
        }
        
        .status-dot {
            width: 10px;
            height: 10px;
            background: var(--neon-green);
            border-radius: 50%;
            animation: pulse 2s infinite;
            box-shadow: 0 0 10px var(--neon-green);
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        /* ===== PANEL PRINCIPAL (CHAT + SE√ëALES) ===== */
        .main-panel {
            display: flex;
            flex-direction: column;
            border-right: 1px solid var(--text-primary);
        }
        
        /* ===== √ÅREA DE CHAT ===== */
        .chat-section {
            flex: 1;
            display: flex;
            flex-direction: column;
            padding: 20px;
            border-bottom: 1px solid var(--text-primary);
            min-height: 50vh;
        }
        
        .section-title {
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 2px;
            margin-bottom: 15px;
            color: var(--text-secondary);
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .section-title::before {
            content: '>';
            color: var(--text-primary);
        }
        
        .chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 15px;
            background: rgba(0, 0, 0, 0.5);
            border: 1px solid var(--text-muted);
            margin-bottom: 15px;
        }
        
        .message {
            margin-bottom: 15px;
            padding: 10px 15px;
            border-left: 2px solid var(--text-muted);
            animation: fadeIn 0.3s ease;
        }
        
        .message.user {
            border-left-color: var(--text-secondary);
            background: rgba(0, 255, 65, 0.05);
        }
        
        .message.ai {
            border-left-color: var(--text-primary);
            background: rgba(0, 255, 65, 0.1);
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .message-time {
            font-size: 0.7rem;
            color: var(--text-muted);
            margin-bottom: 5px;
        }
        
        .message-content {
            font-size: 0.9rem;
            line-height: 1.6;
        }
        
        .chat-input-area {
            display: flex;
            gap: 10px;
        }
        
        #chatInput {
            flex: 1;
            background: var(--panel-bg);
            border: 1px solid var(--text-muted);
            color: var(--text-primary);
            padding: 12px 15px;
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.9rem;
            outline: none;
            transition: all 0.3s;
        }
        
        #chatInput:focus {
            border-color: var(--text-primary);
            box-shadow: var(--border-glow);
        }
        
        #chatInput::placeholder {
            color: var(--text-muted);
        }
        
        .btn {
            background: transparent;
            border: 1px solid var(--text-primary);
            color: var(--text-primary);
            padding: 12px 20px;
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.8rem;
            cursor: pointer;
            text-transform: uppercase;
            letter-spacing: 1px;
            transition: all 0.3s;
        }
        
        .btn:hover {
            background: var(--neon-green);
            color: var(--dark-bg);
            box-shadow: var(--border-glow);
        }
        
        /* ===== √ÅREA DE SE√ëALES ===== */
        .signals-section {
            padding: 20px;
            min-height: 300px;
        }
        
        .signal-card {
            background: var(--panel-bg);
            border: 1px solid var(--text-muted);
            padding: 15px;
            margin-bottom: 10px;
            position: relative;
            overflow: hidden;
        }
        
        .signal-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 3px;
            height: 100%;
        }
        
        .signal-card.buy::before {
            background: var(--buy-color);
            box-shadow: 0 0 10px var(--buy-color);
        }
        
        .signal-card.sell::before {
            background: var(--sell-color);
            box-shadow: 0 0 10px var(--sell-color);
        }
        
        .signal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .signal-type {
            font-size: 1.2rem;
            font-weight: 700;
            letter-spacing: 2px;
        }
        
        .signal-type.buy { color: var(--buy-color); }
        .signal-type.sell { color: var(--sell-color); }
        
        .signal-pair {
            font-size: 0.8rem;
            color: var(--text-muted);
        }
        
        .signal-details {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            font-size: 0.75rem;
        }
        
        .signal-detail {
            padding: 8px;
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid var(--text-muted);
        }
        
        .signal-detail-label {
            color: var(--text-muted);
            margin-bottom: 3px;
        }
        
        .signal-detail-value {
            color: var(--text-primary);
        }
        
        .signal-time {
            font-size: 0.7rem;
            color: var(--text-muted);
            margin-top: 10px;
            text-align: right;
        }
        
        .generate-btn {
            width: 100%;
            margin-top: 15px;
        }
        
        /* ===== PANEL LATERAL (DATOS DE MERCADO) ===== */
        .side-panel {
            background: var(--panel-bg);
            padding: 20px;
            overflow-y: auto;
        }
        
        .market-data {
            margin-top: 20px;
        }
        
        .market-item {
            padding: 12px;
            border: 1px solid var(--text-muted);
            margin-bottom: 8px;
            font-size: 0.8rem;
        }
        
        .market-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
        }
        
        .market-pair {
            font-weight: 700;
            color: var(--text-primary);
        }
        
        .market-price {
            font-size: 1.1rem;
            font-weight: 700;
        }
        
        .market-price.up { color: var(--buy-color); }
        .market-price.down { color: var(--sell-color); }
        
        .market-change {
            font-size: 0.75rem;
        }
        
        .market-change.positive { color: var(--buy-color); }
        .market-change.negative { color: var(--sell-color); }
        
        .market-stats {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 5px;
            margin-top: 8px;
            font-size: 0.7rem;
        }
        
        .market-stat {
            color: var(--text-muted);
        }
        
        .market-stat span {
            color: var(--text-secondary);
        }
        
        .tick-container {
            margin-top: 20px;
            padding: 10px;
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid var(--text-muted);
            max-height: 200px;
            overflow-y: auto;
        }
        
        .tick-title {
            font-size: 0.7rem;
            color: var(--text-muted);
            margin-bottom: 10px;
            text-transform: uppercase;
        }
        
        .tick-item {
            font-size: 0.7rem;
            padding: 3px 0;
            border-bottom: 1px dotted var(--text-muted);
            display: flex;
            justify-content: space-between;
        }
        
        .tick-item span:last-child {
            color: var(--text-secondary);
        }
        
        /* ===== SCROLLBAR ===== */
        ::-webkit-scrollbar {
            width: 5px;
        }
        
        ::-webkit-scrollbar-track {
            background: var(--dark-bg);
        }
        
        ::-webkit-scrollbar-thumb {
            background: var(--text-muted);
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: var(--text-primary);
        }
        
        /* ===== RESPONSIVE ===== */
        @media (max-width: 900px) {
            .container {
                grid-template-columns: 1fr;
                grid-template-rows: auto 1fr auto;
            }
            
            .side-panel {
                border-top: 1px solid var(--text-primary);
            }
        }
        
        /* ===== MODO DISE√ëO ===== */
        .design-mode-active .main-panel,
        .design-mode-active .side-panel,
        .design-mode-active .chat-section,
        .design-mode-active .signals-section,
        .design-mode-active .tradingview-widget-container {
            cursor: move !important;
            outline: 2px dashed var(--neon-green) !important;
            outline-offset: 4px !important;
        }
        
        .design-mode-active .resize-handle {
            display: block !important;
        }
        
        .resize-handle {
            display: none;
            position: absolute;
            width: 15px;
            height: 15px;
            background: var(--neon-green);
            border-radius: 50%;
            cursor: se-resize;
            z-index: 1000;
            animation: pulse-handle 1s infinite;
        }
        
        .resize-handle.top-left { top: -7px; left: -7px; cursor: nw-resize; }
        .resize-handle.top-right { top: -7px; right: -7px; cursor: ne-resize; }
        .resize-handle.bottom-left { bottom: -7px; left: -7px; cursor: sw-resize; }
        .resize-handle.bottom-right { bottom: -7px; right: -7px; cursor: se-resize; }
        
        @keyframes pulse-handle {
            0%, 100% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.3); opacity: 0.7; }
        }
        
        .design-indicator {
            display: none;
            position: fixed;
            top: 10px;
            left: 50%;
            transform: translateX(-50%);
            background: var(--neon-green);
            color: var(--dark-bg);
            padding: 10px 30px;
            font-weight: 700;
            font-size: 0.9rem;
            z-index: 9999;
            border-radius: 5px;
            box-shadow: 0 0 20px var(--neon-green);
            animation: pulse 1s infinite;
        }
        
        .design-mode-active .design-indicator {
            display: block;
        }
        
        .save-design-btn {
            display: none;
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: var(--neon-green);
            color: var(--dark-bg);
            border: none;
            padding: 15px 30px;
            font-family: 'JetBrains Mono', monospace;
            font-size: 1rem;
            font-weight: 700;
            cursor: pointer;
            z-index: 9999;
            border-radius: 5px;
            box-shadow: 0 0 20px var(--neon-green);
            transition: all 0.3s;
        }
        
        .save-design-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 0 30px var(--neon-green);
        }
        
        .design-mode-active .save-design-btn {
            display: block;
        }
        
        .coordinates-modal {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: var(--panel-bg);
            border: 2px solid var(--neon-green);
            padding: 30px;
            z-index: 10000;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
            border-radius: 10px;
            box-shadow: 0 0 50px var(--neon-green-dim);
        }
        
        .coordinates-modal.show {
            display: block;
        }
        
        .coordinates-modal h3 {
            color: var(--neon-green);
            margin-bottom: 20px;
            text-transform: uppercase;
            letter-spacing: 2px;
        }
        
        .coordinates-modal pre {
            background: var(--dark-bg);
            padding: 15px;
            border: 1px solid var(--text-muted);
            overflow-x: auto;
            font-size: 0.8rem;
            color: var(--text-primary);
        }
        
        .coordinates-modal .close-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            background: none;
            border: none;
            color: var(--text-primary);
            font-size: 1.5rem;
            cursor: pointer;
        }
        
        .design-mode-active .interact-active {
            outline: 3px solid var(--neon-green) !important;
            outline-offset: 2px !important;
        }
        
        /* ===== MODO CONSTRUCTOR (Activo con clave) ===== */
        body.constructor-mode .main-panel,
        body.constructor-mode .side-panel,
        body.constructor-mode .chat-section,
        body.constructor-mode .signals-section,
        body.constructor-mode .tradingview-widget-container {
            cursor: move !important;
            outline: 2px dashed var(--neon-green) !important;
            outline-offset: 4px !important;
            transition: outline 0.3s;
        }
        
        body.constructor-mode .tradingview-widget-container {
            cursor: se-resize !important;
        }
        
        body.constructor-mode .chat-section {
            cursor: se-resize !important;
        }
        
        /* Indicador especial para modo constructor */
        .constructor-indicator {
            display: none;
            position: fixed;
            top: 80px;
            left: 50%;
            transform: translateX(-50%);
            background: linear-gradient(135deg, #00ff41, #00cc33);
            color: #000;
            padding: 12px 40px;
            font-weight: 700;
            font-size: 1rem;
            z-index: 9999;
            border-radius: 25px;
            box-shadow: 0 0 30px #00ff41;
            animation: pulse-constructor 1s infinite;
            text-transform: uppercase;
            letter-spacing: 2px;
        }
        
        @keyframes pulse-constructor {
            0%, 100% { transform: translateX(-50%) scale(1); }
            50% { transform: translateX(-50%) scale(1.05); }
        }
        
        body.constructor-mode .constructor-indicator {
            display: block;
        }
        
        /* Bot√≥n verde mejorado para Guardar Dise√±o */
        .save-design-btn {
            display: none;
            position: fixed;
            bottom: 30px;
            right: 30px;
            background: linear-gradient(135deg, #00ff41, #00cc33) !important;
            color: #000 !important;
            border: none;
            padding: 18px 35px;
            font-family: 'JetBrains Mono', monospace;
            font-size: 1.1rem;
            font-weight: 700;
            cursor: pointer;
            z-index: 9999;
            border-radius: 30px;
            box-shadow: 0 0 30px #00ff41, 0 5px 15px rgba(0,0,0,0.3);
            transition: all 0.3s;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .save-design-btn:hover {
            transform: scale(1.08) translateY(-3px);
            box-shadow: 0 0 50px #00ff41, 0 10px 25px rgba(0,0,0,0.4);
        }
        
        .save-design-btn:active {
            transform: scale(0.98);
        }
        
        body.constructor-mode .save-design-btn {
            display: block;
            animation: slideIn 0.5s ease;
        }
        
        @keyframes slideIn {
            from { transform: translateX(100px); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        /* Modal de coordenadas mejorado */
        .coordinates-modal {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: var(--panel-bg);
            border: 3px solid #00ff41;
            padding: 40px;
            z-index: 10000;
            max-width: 700px;
            max-height: 85vh;
            overflow-y: auto;
            border-radius: 15px;
            box-shadow: 0 0 60px #00ff4144, 0 20px 50px rgba(0,0,0,0.5);
        }
        
        .coordinates-modal.show {
            display: block;
            animation: modalIn 0.3s ease;
        }
        
        @keyframes modalIn {
            from { transform: translate(-50%, -50%) scale(0.8); opacity: 0; }
            to { transform: translate(-50%, -50%) scale(1); opacity: 1; }
        }
        
        .coordinates-modal h3 {
            color: #00ff41;
            margin-bottom: 25px;
            text-transform: uppercase;
            letter-spacing: 3px;
            font-size: 1.3rem;
            text-shadow: 0 0 10px #00ff41;
        }
        
        .coordinates-modal pre {
            background: #0a0a0a;
            padding: 20px;
            border: 1px solid #00ff4144;
            overflow-x: auto;
            font-size: 0.75rem;
            color: #00ff41;
            border-radius: 8px;
            line-height: 1.6;
        }
        
        .coordinates-modal .close-btn {
            position: absolute;
            top: 15px;
            right: 15px;
            background: none;
            border: none;
            color: #00ff41;
            font-size: 2rem;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .coordinates-modal .close-btn:hover {
            transform: rotate(90deg);
            color: #ff0040;
        }
        
        /* Credenciales destacadas */
        footer .credits-highlight {
            color: #00ff41;
            font-weight: 700;
            text-shadow: 0 0 10px #00ff41;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- HEADER -->
        <header>
            <div class="logo">Trading<span>-Chat</span>-IA</div>
            <div class="status-indicator">
                <div class="status-dot"></div>
                <span id="statusText">SISTEMA ACTIVO | MODO ONLINE</span>
            </div>
        </header>
        
        <!-- PANEL DE AJUSTES -->
        <div class="settings-panel">
            <div class="settings-group">
                <span class="settings-label">Tema:</span>
                <select class="settings-select" id="themeSelect" onchange="changeTheme()">
                    <option value="matrix">Matrix (Predeterminado)</option>
                    <option value="bw">Blanco y Negro</option>
                    <option value="dark">Oscuro (Dark Mode)</option>
                    <option value="light">Claro (Light Mode)</option>
                    <option value="neon">Neon Night</option>
                </select>
            </div>
            <div class="settings-group">
                <span class="settings-label">Idioma:</span>
                <input type="text" class="language-search" id="languageSearch" placeholder="Buscar idioma..." oninput="filterLanguages()">
                <select class="settings-select" id="languageSelect" onchange="changeLanguage()">
                    <option value="es">Espa√±ol</option>
                    <option value="en">English</option>
                    <option value="pt">Portugu√™s</option>
                    <option value="fr">Fran√ßais</option>
                    <option value="de">Deutsch</option>
                    <option value="it">Italiano</option>
                    <option value="ru">–†—É—Å—Å–∫–∏–π</option>
                    <option value="zh">‰∏≠Êñá</option>
                    <option value="ja">Êó•Êú¨Ë™û</option>
                    <option value="ko">ÌïúÍµ≠Ïñ¥</option>
                    <option value="ar">ÿßŸÑÿπÿ±ÿ®Ÿäÿ©</option>
                    <option value="hi">‡§π‡§ø‡§®‡•ç‡§¶‡•Ä</option>
                    <option value="tr">T√ºrk√ße</option>
                    <option value="pl">Polski</option>
                    <option value="nl">Nederlands</option>
                    <option value="sv">Svenska</option>
                    <option value="da">Dansk</option>
                    <option value="fi">Suomi</option>
                    <option value="no">Norsk</option>
                    <option value="cs">ƒåe≈°tina</option>
                    <option value="el">ŒïŒªŒªŒ∑ŒΩŒπŒ∫Œ¨</option>
                    <option value="he">◊¢◊ë◊®◊ô◊™</option>
                    <option value="th">‡πÑ‡∏ó‡∏¢</option>
                    <option value="vi">Ti·∫øng Vi·ªát</option>
                    <option value="id">Bahasa Indonesia</option>
                    <option value="ms">Bahasa Melayu</option>
                    <option value="tl">Tagalog</option>
                    <option value="uk">–£–∫—Ä–∞—ó–Ω—Å—å–∫–∞</option>
                    <option value="hu">Magyar</option>
                    <option value="ro">Rom√¢nƒÉ</option>
                    <option value="bg">–ë—ä–ª–≥–∞—Ä—Å–∫–∏</option>
                    <option value="sk">Slovenƒçina</option>
                    <option value="hr">Hrvatski</option>
                    <option value="sr">–°—Ä–ø—Å–∫–∏</option>
                    <option value="lt">Lietuvi≈≥</option>
                    <option value="lv">Latvie≈°u</option>
                    <option value="et">Eesti</option>
                    <option value="sl">Sloven≈°ƒçina</option>
                    <option value="is">√çslenska</option>
                    <option value="ca">Catal√†</option>
                    <option value="eu">Euskara</option>
                    <option value="gl">Galego</option>
                    <option value="af">Afrikaans</option>
                    <option value="sw">Kiswahili</option>
                    <option value="ml">‡¥Æ‡¥≤‡¥Ø‡¥æ‡¥≥‡¥Ç</option>
                    <option value="ta">‡Æ§‡ÆÆ‡Æø‡Æ¥‡Øç</option>
                    <option value="te">‡∞§‡±Ü‡∞≤‡±Å‡∞ó‡±Å</option>
                    <option value="bn">‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ</option>
                    <option value="pa">‡®™‡©∞‡®ú‡®æ‡®¨‡©Ä</option>
                    <option value="gu">‡™ó‡´Å‡™ú‡™∞‡™æ‡™§‡´Ä</option>
                    <option name="kn">‡≤ï‡≤®‡≥ç‡≤®‡≤°</option>
                    <option value="mr">‡§Æ‡§∞‡§æ‡§†‡•Ä</option>
                    <option value="ne">‡§®‡•á‡§™‡§æ‡§≤‡•Ä</option>
                    <option value="si">‡∑É‡∑í‡∂Ç‡∑Ñ‡∂Ω</option>
                    <option value="km">·ûÅ·üí·ûò·üÇ·ûö</option>
                    <option value="lo">‡∫•‡∫≤‡∫ß</option>
                    <option value="my">·Äô·Äº·Äî·Ä∫·Äô·Ä¨</option>
                    <option value="ka">·É•·Éê·É†·Éó·É£·Éö·Éò</option>
                    <option value="am">·ä†·àõ·à≠·äõ</option>
                    <option value="ha">Hausa</option>
                    <option value="yo">Yor√πb√°</option>
                    <option value="zu">Zulu</option>
                </select>
            </div>
        </div>
        
        <!-- PANEL PRINCIPAL -->
        <div class="main-panel">
            <!-- CHAT SECTION -->
            <div class="chat-section">
                <div class="section-title" id="chatTitle">Asistente de IA Universal</div>
                <div class="chat-messages" id="chatMessages">
                    <div class="message ai">
                        <div class="message-time">Sistema</div>
                        <div class="message-content">
                            ‚ñì‚ñì‚ñì CONEXI√ìN ESTABLECIDA ‚ñì‚ñì‚ñì<br><br>
                            Bienvenido al Sistema de IA Universal v1.0<br>
                            Motor de conocimiento infinito activado.<br><br>
                            Puedo responder sobre cualquier tema del mundo.<br>
                            Preg√∫ntame lo que quieras.
                        </div>
                    </div>
                </div>
                <div class="chat-input-area">
                    <input type="text" id="chatInput" placeholder="Preg√∫ntame lo que quieras sobre el mundo..." autocomplete="off">
                    <button class="btn" onclick="sendMessage()">Enviar</button>
                </div>
            </div>
            
            <!-- SE√ëALES SECTION -->
            <div class="signals-section">
                <div class="section-title" id="signalsTitle">Generador de Se√±ales</div>
                <div id="signalsContainer">
                    <!-- Las se√±ales se generar√°n aqu√≠ -->
                </div>
                <button class="btn generate-btn" onclick="generateSignal()">Generar Se√±al</button>
            </div>
        </div>
        
        <!-- PANEL LATERAL -->
        <div class="side-panel">
            <div class="section-title" id="marketTitle">Mercado XAUUSD</div>
            
            <!-- TradingView Widget -->
            <div class="tradingview-widget-container" style="height:280px;margin-bottom:10px;">
                <div id="tradingview_chart"></div>
            </div>
            
            <div class="market-data" id="marketData">
                <!-- Datos del mercado se actualizan aqu√≠ -->
            </div>
            
            <div class="tick-container">
                <div class="tick-title" id="tickTitle">Flujo de Ticks en Vivo</div>
                <div id="tickFeed">
                    <!-- Ticks se muestran aqu√≠ -->
                </div>
            </div>
        </div>
    </div>

    <script>
        // ===== FUNCIONES DE TEMA =====
        function changeTheme() {
            const theme = document.getElementById('themeSelect').value;
            document.body.className = '';
            if (theme !== 'matrix') {
                document.body.classList.add('theme-' + theme);
            }
            localStorage.setItem('trading-chat-theme', theme);
        }
        
        // Cargar tema guardado
        const savedTheme = localStorage.getItem('trading-chat-theme');
        if (savedTheme && savedTheme !== 'matrix') {
            document.body.classList.add('theme-' + savedTheme);
            document.getElementById('themeSelect').value = savedTheme;
        }
        
        // ===== FUNCIONES DE IDIOMA =====
        let currentLanguage = 'es';
        
        function filterLanguages() {
            const search = document.getElementById('languageSearch').value.toLowerCase();
            const select = document.getElementById('languageSelect');
            const options = select.options;
            
            for (let i = 0; i < options.length; i++) {
                const text = options[i].text.toLowerCase();
                const value = options[i].value.toLowerCase();
                if (text.includes(search) || value.includes(search)) {
                    options[i].style.display = '';
                } else {
                    options[i].style.display = 'none';
                }
            }
        }
        
        function changeLanguage() {
            const lang = document.getElementById('languageSelect').value;
            currentLanguage = lang;
            localStorage.setItem('trading-chat-lang', lang);
            updateInterface();
        }
        
        // Cargar idioma guardado
        const savedLang = localStorage.getItem('trading-chat-lang');
        if (savedLang) {
            document.getElementById('languageSelect').value = savedLang;
            currentLanguage = savedLang;
        }
        
        // ===== TRADUCCIONES DE INTERFAZ =====
        const translations = {
            es: {
                title: 'Asistente de IA Universal',
                inputPlaceholder: 'Preg√∫ntame lo que quieras sobre el mundo...',
                sendBtn: 'Enviar',
                signalsTitle: 'Generador de Se√±ales',
                generateBtn: 'Generar Se√±al',
                marketTitle: 'Mercado XAUUSD',
                tickTitle: 'Flujo de Ticks en Vivo',
                statusText: 'SISTEMA ACTIVO | MODO ONLINE',
                credits: 'Desarrollado por Ferreira Gustavo Javier, IA sencilla desde casa por un menor de edad'
            },
            en: {
                title: 'Universal AI Assistant',
                inputPlaceholder: 'Ask me anything about the world...',
                sendBtn: 'Send',
                signalsTitle: 'Signal Generator',
                generateBtn: 'Generate Signal',
                marketTitle: 'XAUUSD Market',
                tickTitle: 'Live Tick Flow',
                statusText: 'SYSTEM ACTIVE | ONLINE MODE',
                credits: 'Developed by Ferreira Gustavo Javier, simple AI from home by a minor'
            },
            pt: {
                title: 'Assistente de IA Universal',
                inputPlaceholder: 'Pergunte-me qualquer coisa sobre o mundo...',
                sendBtn: 'Enviar',
                signalsTitle: 'Gerador de Sinais',
                generateBtn: 'Gerar Sinal',
                marketTitle: 'Mercado XAUUSD',
                tickTitle: 'Fluxo de Ticks ao Vivo',
                statusText: 'SISTEMA ATIVO | MODO ONLINE',
                credits: 'Desenvolvido por Ferreira Gustavo Javier, IA simples de casa por menor de idade'
            },
            fr: {
                title: 'Assistant IA Universel',
                inputPlaceholder: 'Demandez-moi tout sur le monde...',
                sendBtn: 'Envoyer',
                signalsTitle: 'G√©n√©rateur de Signaux',
                generateBtn: 'G√©n√©rer un Signal',
                marketTitle: 'March√© XAUUSD',
                tickTitle: 'Flux de Ticks en Direct',
                statusText: 'SYST√àME ACTIF | MODE EN LIGNE',
                credits: 'D√©velopp√© par Ferreira Gustavo Javier, IA simple √† la maison par un mineur'
            },
            de: {
                title: 'Universaler KI-Assistent',
                inputPlaceholder: 'Frage mich alles √ºber die Welt...',
                sendBtn: 'Senden',
                signalsTitle: 'Signalgenerator',
                generateBtn: 'Signal Generieren',
                marketTitle: 'XAUUSD Markt',
                tickTitle: 'Live Tick-Fluss',
                statusText: 'SYSTEM AKTIV | ONLINE-MODUS',
                credits: 'Entwickelt von Ferreira Gustavo Javier, einfache KI von zu Hause durch einen Minderj√§hrigen'
            }
        };
        
        // Funci√≥n para actualizar la interfaz
        function updateInterface() {
            const t = translations[currentLanguage] || translations.es;
            
            // Chat
            const chatTitle = document.getElementById('chatTitle');
            if (chatTitle) chatTitle.textContent = t.title;
            
            const chatInput = document.getElementById('chatInput');
            if (chatInput) chatInput.placeholder = t.inputPlaceholder;
            
            // Signals
            const signalsTitle = document.getElementById('signalsTitle');
            if (signalsTitle) signalsTitle.textContent = t.signalsTitle;
            
            const genBtn = document.querySelector('.generate-btn');
            if (genBtn) genBtn.textContent = t.generateBtn;
            
            // Market
            const marketTitle = document.getElementById('marketTitle');
            if (marketTitle) marketTitle.textContent = t.marketTitle;
            
            const tickTitle = document.getElementById('tickTitle');
            if (tickTitle) tickTitle.textContent = t.tickTitle;
            
            // Status header
            const statusText = document.getElementById('statusText');
            if (statusText) statusText.textContent = t.statusText;
            
            // Credits
            const creditsEl = document.getElementById('creditsText');
            if (creditsEl) creditsEl.textContent = t.credits;
        }
        
        // Inicializar interfaz
        updateInterface();
        
        // ===== CONFIGURACI√ìN API =====
        const API_URL = '/api/chat';

        // ===== BASE DE DATOS DE ESTRATEGIAS =====
        const tradingStrategies = {
            SMC: {
                name: "Smart Money Concepts",
                concepts: [
                    "Order Blocks - Zonas de acumulaci√≥n institucional",
                    "Fair Value Gap - Espacios vac√≠os entre movimientos",
                    "Liquidity Sweeps - Barridos de liquidez",
                    "Change of Character - Cambio de estructura",
                    "Break of Structure - Ruptura de estructura"
                ],
                responses: [
                    "Seg√∫n SMC, el precio est√° buscando liquidez antes de continuar.",
                    "El concepto de Smart Money indica que los grandes participantes est√°n acumulando.",
                    "La estructura muestra un cambio de car√°cter.",
                    "Los liquidity sweeps indican que el mercado est√° buscando √≥rdenes de stop."
                ]
            },
            ICT: {
                name: "Inner Circle Trading",
                concepts: [
                    "Market Structure Shift - MSS",
                    "Optimal Trade Entry - OTE",
                    "Stop Hunt / Stop Run",
                    "Daily/Weekly Highs/Lows",
                    "Fibonacci confluences"
                ],
                responses: [
                    "En ICT, busca el Optimal Trade Entry.",
                    "El Market Structure Shift ha ocurrido.",
                    "Los institucionales est√°n corriendo los stops.",
                    "La mejor configuraci√≥n es esperar el fair value gap."
                ]
            },
            PriceAction: {
                name: "Price Action",
                concepts: [
                    "Engulfing Patterns",
                    "Doji and Pin Bars",
                    "Inside Bars",
                    "Trend Lines and Channels",
                    "Support and Resistance"
                ],
                responses: [
                    "El price action muestra un posible engulfing.",
                    "Un pin bar en zona de soporte indica reversa potencial.",
                    "El inside bar sugiere consolidaci√≥n.",
                    "El precio est√° respetando las l√≠neas de tendencia."
                ]
            }
        };

        // ===== SIMULATE AI RESPONSE =====
        function simulateAIResponse(prompt) {
            const lowerPrompt = prompt.toLowerCase();
            let responses = [
                "He analizado tu consulta. Como IA de conocimiento universal, puedo ayudarte con cualquier tema.",
                "Gracias por tu pregunta. Estoy listo para responder sobre cualquier tema que necesites.",
                "Interesante consulta. Como IA avanzada, tengo conocimiento sobre muchos temas del mundo."
            ];
            
            // Detectar el tipo de consulta
            if (lowerPrompt.includes('estrategia') || lowerPrompt.includes('trading') || lowerPrompt.includes('mercado')) {
                responses = [
                    "Para una operaci√≥n exitosa, considera: 1) Identifica la estructura del mercado, 2) Busca zonas de liquidez, 3) Gestiona tu riesgo.",
                    "Bas√°ndome en SMC e ICT, el mercado muestra se√±ales de acumulaci√≥n institucional.",
                    "Implementa esta metodolog√≠a: 1) Define la tendencia, 2) Identifica zonas clave, 3) Espera confirmaci√≥n."
                ];
            }
            
            return responses[Math.floor(Math.random() * responses.length)];
        }

        // Send to Serverless Function
        async function sendToGemini(prompt) {
            try {
                const response = await fetch(API_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        message: 'Responde exclusivamente en ' + currentLanguage + '. No uses ingl√©s a menos que el usuario lo pida. ' + prompt,
                        language: currentLanguage
                    })
                });
                
                if (!response.ok) {
                    throw new Error('HTTP error: ' + response.status);
                }
                
                const data = await response.json();
                return data.response;
            } catch (error) {
                console.error('Error en API:', error);
                return '[ERROR] Fallo de conexi√≥n: ' + error.message;
            }
        }

        // ===== DETECTOR DE CLAVE SECRETA =====
        const SECRET_KEY = 'misiones2026';
        let constructorMode = false;
        
        function checkForSecretKey(message) {
            const lowerMessage = message.toLowerCase().trim();
            if (lowerMessage === SECRET_KEY) {
                activateConstructorMode();
                return true;
            }
            return false;
        }
        
        function activateConstructorMode() {
            constructorMode = true;
            document.body.classList.add('constructor-mode');
            document.body.classList.add('design-mode-active');
            
            // Mostrar mensaje de activaci√≥n
            addMessage('üîì <strong>MODO CONSTRUCTOR ACTIVADO</strong><br><br>Ahora puedes:<br>‚Ä¢ Arrastrar los paneles con el mouse<br>‚Ä¢ Redimensionar el gr√°fico TradingView<br>‚Ä¢ Redimensionar el asistente de trading<br><br>Usa el bot√≥n verde "Guardar Dise√±o" para guardar los cambios.', 'ai');
            
            // Habilitar interact.js para movimiento
            enableConstructorInteractions();
        }
        
        function deactivateConstructorMode() {
            constructorMode = false;
            document.body.classList.remove('constructor-mode');
            document.body.classList.remove('design-mode-active');
            
            // Deshabilitar interact.js
            disableConstructorInteractions();
            
            addMessage('üîí <strong>MODO CONSTRUCTOR DESACTIVADO</strong><br><br>El dise√±o ha sido guardado.', 'ai');
        }
        
        // ===== CHAT FUNCTIONALITY =====
        async function sendMessage() {
            const input = document.getElementById('chatInput');
            const message = input.value.trim();
            
            if (!message) return;
            
            // Verificar si es la clave secreta
            if (checkForSecretKey(message)) {
                input.value = '';
                return;
            }
            
            // Add user message
            addMessage(message, 'user');
            input.value = '';
            
            // Show loading message
            const loadingDiv = document.createElement('div');
            loadingDiv.className = 'message ai';
            loadingDiv.id = 'loadingMessage';
            loadingDiv.innerHTML = `
                <div class="message-time">IA | Procesando...</div>
                <div class="message-content">‚ñì‚ñì‚ñì Analizando...</div>
            `;
            document.getElementById('chatMessages').appendChild(loadingDiv);
            document.getElementById('chatMessages').scrollTop = document.getElementById('chatMessages').scrollHeight;
            
            try {
                const response = await sendToGemini(message);
                
                const loadingMsg = document.getElementById('loadingMessage');
                if (loadingMsg) loadingMsg.remove();
                
                addMessage(response, 'ai');
            } catch (error) {
                const loadingMsg = document.getElementById('loadingMessage');
                if (loadingMsg) loadingMsg.remove();
                
                const fallbackResponse = simulateAIResponse(message);
                addMessage(fallbackResponse + '\n\n[NOTA: API no disponible, usando modo offline]', 'ai');
            }
        }

        function addMessage(content, type) {
            const messagesContainer = document.getElementById('chatMessages');
            const time = new Date().toLocaleTimeString('es-AR', { hour: '2-digit', minute: '2-digit' });
            
            const messageDiv = document.createElement('div');
            messageDiv.className = 'message ' + type;
            messageDiv.innerHTML = `
                <div class="message-time">${type === 'user' ? 'Usuario' : 'IA'} | ${time}</div>
                <div class="message-content">${content}</div>
            `;
            
            messagesContainer.appendChild(messageDiv);
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }

        // Enter key to send
        document.getElementById('chatInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                sendMessage();
            }
        });

        // ===== SIGNAL GENERATOR =====
        function generateSignal() {
            const signals = ['BUY', 'SELL'];
            const signal = signals[Math.floor(Math.random() * signals.length)];
            
            const basePrice = 2650.00;
            const variation = (Math.random() - 0.5) * 50;
            const price = (basePrice + variation).toFixed(2);
            
            const entry = (parseFloat(price) + (signal === 'BUY' ? -5 : 5)).toFixed(2);
            const stopLoss = (parseFloat(price) + (signal === 'BUY' ? -25 : 25)).toFixed(2);
            const takeProfit = (parseFloat(price) + (signal === 'BUY' ? 40 : -40)).toFixed(2);
            
            const timeframes = ['M15', 'H1', 'H4', 'D1'];
            const timeframe = timeframes[Math.floor(Math.random() * timeframes.length)];
            const confidence = Math.floor(70 + Math.random() * 25);
            
            const strategyKeys = Object.keys(tradingStrategies);
            const strategyKey = strategyKeys[Math.floor(Math.random() * strategyKeys.length)];
            const strategy = tradingStrategies[strategyKey];
            const concept = strategy.concepts[Math.floor(Math.random() * strategy.concepts.length)];
            
            const time = new Date().toLocaleTimeString('es-AR', { hour: '2-digit', minute: '2-digit', second: '2-digit' });
            
            const signalCard = document.createElement('div');
            signalCard.className = 'signal-card ' + signal.toLowerCase();
            signalCard.innerHTML = `
                <div class="signal-header">
                    <span class="signal-type ${signal.toLowerCase()}">‚óÑ ${signal} ‚ñ∫</span>
                    <span class="signal-pair">XAUUSD</span>
                </div>
                <div class="signal-details">
                    <div class="signal-detail">
                        <div class="signal-detail-label">Entrada</div>
                        <div class="signal-detail-value">${entry}</div>
                    </div>
                    <div class="signal-detail">
                        <div class="signal-detail-label">Stop Loss</div>
                        <div class="signal-detail-value">${stopLoss}</div>
                    </div>
                    <div class="signal-detail">
                        <div class="signal-detail-label">Take Profit</div>
                        <div class="signal-detail-value">${takeProfit}</div>
                    </div>
                </div>
                <div class="signal-details" style="margin-top: 8px;">
                    <div class="signal-detail">
                        <div class="signal-detail-label">Timeframe</div>
                        <div class="signal-detail-value">${timeframe}</div>
                    </div>
                    <div class="signal-detail">
                        <div class="signal-detail-label">Confianza</div>
                        <div class="signal-detail-value">${confidence}%</div>
                    </div>
                    <div class="signal-detail">
                        <div class="signal-detail-label">Estrategia</div>
                        <div class="signal-detail-value">${strategyKey}</div>
                    </div>
                </div>
                <div style="margin-top: 10px; padding: 8px; background: rgba(0,0,0,0.3); border: 1px solid var(--text-muted); font-size: 0.7rem;">
                    ${concept}
                </div>
                <div class="signal-time">${time}</div>
            `;
            
            const container = document.getElementById('signalsContainer');
            container.insertBefore(signalCard, container.firstChild);
            
            while (container.children.length > 5) {
                container.removeChild(container.lastChild);
            }
        }

        // ===== MARKET DATA SIMULATION =====
        let currentPrice = 2650.00;
        
        function updateMarketData() {
            const change = (Math.random() - 0.5) * 2;
            currentPrice += change;
            
            const priceFormatted = currentPrice.toFixed(2);
            const changeValue = change.toFixed(2);
            const changePercent = ((change / currentPrice) * 100).toFixed(3);
            const isUp = change >= 0;
            
            const high = (currentPrice + Math.random() * 20).toFixed(2);
            const low = (currentPrice - Math.random() * 20).toFixed(2);
            const volume = Math.floor(100000 + Math.random() * 50000);
            
            const marketData = document.getElementById('marketData');
            if (marketData) {
                marketData.innerHTML = `
                    <div class="market-item">
                        <div class="market-header">
                            <span class="market-pair">XAU/USD</span>
                            <span class="market-price ${isUp ? 'up' : 'down'}">${priceFormatted}</span>
                        </div>
                        <div class="market-change ${isUp ? 'positive' : 'negative'}">
                            ${isUp ? '‚ñ≤' : '‚ñº'} ${changeValue} (${changePercent}%)
                        </div>
                        <div class="market-stats">
                            <div class="market-stat">Alto: <span>${high}</span></div>
                            <div class="market-stat">Bajo: <span>${low}</span></div>
                            <div class="market-stat">Volumen: <span>${volume.toLocaleString()}</span></div>
                            <div class="market-stat">Spread: <span>${(Math.random() * 0.5 + 0.2).toFixed(1)}</span></div>
                        </div>
                    </div>
                `;
            }
        }

        // ===== TICK FEED =====
        function addTick() {
            const tickValue = (currentPrice + (Math.random() - 0.5) * 0.5).toFixed(2);
            const time = new Date().toLocaleTimeString('es-AR', { hour: '2-digit', minute: '2-digit', second: '2-digit' });
            
            const tickFeed = document.getElementById('tickFeed');
            if (tickFeed) {
                const tickItem = document.createElement('div');
                tickItem.className = 'tick-item';
                tickItem.innerHTML = `
                    <span>${time}</span>
                    <span>${tickValue}</span>
                `;
                
                tickFeed.insertBefore(tickItem, tickFeed.firstChild);
                
                while (tickFeed.children.length > 20) {
                    tickFeed.removeChild(tickFeed.lastChild);
                }
            }
        }

        // ===== INITIALIZATION =====
        
        // ===== INTERACT.JS - Solo funciona en modo constructor =====
        // Por defecto desactivado para que el p√∫blico no pueda mover nada
        // Se activa cuando el usuario escribe 'misiones2026' en el chat
        
        updateMarketData();
        
        for (let i = 0; i < 10; i++) {
            addTick();
        }
        
        generateSignal();
        
        setInterval(updateMarketData, 2000);
        setInterval(addTick, 500);
        
        // ===== MODO DISE√ëO =====
        let designMode = false;
        const DESIGN_STORAGE_KEY = 'trading-chat-design';
        
        // Verificar si hay un dise√±o guardado y estaba activo
        function initDesignMode() {
            const savedDesign = localStorage.getItem(DESIGN_STORAGE_KEY);
            if (savedDesign) {
                try {
                    const designData = JSON.parse(savedDesign);
                    applyDesignState(designData);
                } catch (e) {
                    console.error('Error al cargar dise√±o:', e);
                }
            }
        }
        
        // Aplicar estado del dise√±o
        function applyDesignState(designData) {
            if (!designData) return;
            
            // Restaurar main-panel
            if (designData.mainPanel) {
                const mainPanel = document.querySelector('.main-panel');
                if (mainPanel && designData.mainPanel.transform) {
                    mainPanel.style.transform = designData.mainPanel.transform;
                    mainPanel.setAttribute('data-x', designData.mainPanel.x || 0);
                    mainPanel.setAttribute('data-y', designData.mainPanel.y || 0);
                }
            }
            
            // Restaurar side-panel
            if (designData.sidePanel) {
                const sidePanel = document.querySelector('.side-panel');
                if (sidePanel && designData.sidePanel.transform) {
                    sidePanel.style.transform = designData.sidePanel.transform;
                    sidePanel.setAttribute('data-x', designData.sidePanel.x || 0);
                    sidePanel.setAttribute('data-y', designData.sidePanel.y || 0);
                }
            }
            
            // Restaurar chat-section
            if (designData.chatSection) {
                const chatSection = document.querySelector('.chat-section');
                if (chatSection) {
                    if (designData.chatSection.width) chatSection.style.width = designData.chatSection.width;
                    if (designData.chatSection.height) chatSection.style.height = designData.chatSection.height;
                    if (designData.chatSection.transform) {
                        chatSection.style.transform = designData.chatSection.transform;
                        chatSection.setAttribute('data-x', designData.chatSection.x || 0);
                        chatSection.setAttribute('data-y', designData.chatSection.y || 0);
                    }
                }
            }
            
            // Restaurar signals-section
            if (designData.signalsSection) {
                const signalsSection = document.querySelector('.signals-section');
                if (signalsSection) {
                    if (designData.signalsSection.width) signalsSection.style.width = designData.signalsSection.width;
                    if (designData.signalsSection.height) signalsSection.style.height = designData.signalsSection.height;
                }
            }
            
            // Restaurar gr√°fico TradingView
            if (designData.tradingView) {
                const tradingViewContainer = document.querySelector('.tradingview-widget-container');
                if (tradingViewContainer) {
                    if (designData.tradingView.width) tradingViewContainer.style.width = designData.tradingView.width;
                    if (designData.tradingView.height) {
                        tradingViewContainer.style.height = designData.tradingView.height;
                        // Actualizar el contenedor interno del gr√°fico
                        const chartDiv = document.getElementById('tradingview_chart');
                        if (chartDiv) {
                            chartDiv.style.height = designData.tradingView.height;
                        }
                    }
                }
            }
            
            // Adaptar el gr√°fico de TradingView al nuevo tama√±o
            setTimeout(() => resizeTradingViewChart(), 100);
        }
        
        // Obtener estado actual del dise√±o
        function getDesignState() {
            const mainPanel = document.querySelector('.main-panel');
            const sidePanel = document.querySelector('.side-panel');
            const chatSection = document.querySelector('.chat-section');
            const signalsSection = document.querySelector('.signals-section');
            const tradingViewContainer = document.querySelector('.tradingview-widget-container');
            
            return {
                mainPanel: {
                    transform: mainPanel?.style.transform || '',
                    x: mainPanel?.getAttribute('data-x') || 0,
                    y: mainPanel?.getAttribute('data-y') || 0
                },
                sidePanel: {
                    transform: sidePanel?.style.transform || '',
                    x: sidePanel?.getAttribute('data-x') || 0,
                    y: sidePanel?.getAttribute('data-y') || 0
                },
                chatSection: {
                    width: chatSection?.style.width || '',
                    height: chatSection?.style.height || '',
                    transform: chatSection?.style.transform || '',
                    x: chatSection?.getAttribute('data-x') || 0,
                    y: chatSection?.getAttribute('data-y') || 0
                },
                signalsSection: {
                    width: signalsSection?.style.width || '',
                    height: signalsSection?.style.height || ''
                },
                tradingView: {
                    width: tradingViewContainer?.style.width || '',
                    height: tradingViewContainer?.style.height || ''
                }
            };
        }
        
        // Guardar estado del dise√±o
        function saveDesignState() {
            const designState = getDesignState();
            localStorage.setItem(DESIGN_STORAGE_KEY, JSON.stringify(designState));
        }
        
        // Activar modo dise√±o
        function activateDesignMode() {
            designMode = true;
            document.body.classList.add('design-mode-active');
            saveDesignState();
        }
        
        // Guardar dise√±o espec√≠fico del modo constructor
        function saveConstructorDesign() {
            saveDesignState();
            showCoordinates();
            
            // Mensaje de confirmaci√≥n
            addMessage('‚úÖ <strong>DISE√ëO GUARDADO</strong><br><br>Las posiciones han sido guardadas permanentemente.<br>El c√≥digo CSS est√° disponible en el modal.', 'ai');
        }
        
        // Desactivar modo dise√±o
        function deactivateDesignMode() {
            designMode = false;
            document.body.classList.remove('design-mode-active');
            saveDesignState();
        }
        
        // Alternar modo dise√±o
        function toggleDesignMode() {
            if (designMode) {
                deactivateDesignMode();
            } else {
                activateDesignMode();
            }
        }
        
        // ===== INTERACT.JS - Solo activar en modo constructor =====
        let interactMainPanel, interactSidePanel, interactChatSection, interactTradingView;
        
        function enableConstructorInteractions() {
            // Habilitar drag para main-panel
            interactMainPanel = interact('.main-panel').draggable({
                listeners: {
                    move (event) {
                        if (!constructorMode) return;
                        const target = event.target;
                        const x = (parseFloat(target.getAttribute('data-x')) || 0) + event.dx;
                        const y = (parseFloat(target.getAttribute('data-y')) || 0) + event.dy;
                        target.style.transform = 'translate(' + x + 'px, ' + y + 'px)';
                        target.setAttribute('data-x', x);
                        target.setAttribute('data-y', y);
                    }
                }
            });
            
            // Habilitar drag para side-panel
            interactSidePanel = interact('.side-panel').draggable({
                listeners: {
                    move (event) {
                        if (!constructorMode) return;
                        const target = event.target;
                        const x = (parseFloat(target.getAttribute('data-x')) || 0) + event.dx;
                        const y = (parseFloat(target.getAttribute('data-y')) || 0) + event.dy;
                        target.style.transform = 'translate(' + x + 'px, ' + y + 'px)';
                        target.setAttribute('data-x', x);
                        target.setAttribute('data-y', y);
                    }
                }
            });
            
            // Habilitar resize para chat-section
            interactChatSection = interact('.chat-section').resizable({
                edges: { left: true, right: true, bottom: true, top: true },
                listeners: {
                    move (event) {
                        if (!constructorMode) return;
                        let { x, y } = event.target.dataset;
                        x = (parseFloat(x) || 0) + event.deltaRect.left;
                        y = (parseFloat(y) || 0) + event.deltaRect.top;
                        Object.assign(event.target.style, {
                            width: event.rect.width + 'px',
                            height: event.rect.height + 'px',
                            transform: 'translate(' + x + 'px,' + y + 'px)'
                        });
                        event.target.dataset.x = x;
                        event.target.dataset.y = y;
                    }
                }
            });
            
            // Habilitar resize para TradingView
            interactTradingView = interact('.tradingview-widget-container').resizable({
                edges: { left: true, right: true, bottom: true, top: true },
                listeners: {
                    move (event) {
                        if (!constructorMode) return;
                        let { x, y } = event.target.dataset;
                        x = (parseFloat(x) || 0) + event.deltaRect.left;
                        y = (parseFloat(y) || 0) + event.deltaRect.top;
                        Object.assign(event.target.style, {
                            width: event.rect.width + 'px',
                            height: event.rect.height + 'px',
                            transform: 'translate(' + x + 'px,' + y + 'px)'
                        });
                        event.target.dataset.x = x;
                        event.target.dataset.y = y;
                        setTimeout(resizeTradingViewChart, 50);
                    }
                }
            });
        }
        
        function disableConstructorInteractions() {
            // Desconectar todos los interact
            if (interactMainPanel) { interactMainPanel.unset(); interactMainPanel = null; }
            if (interactSidePanel) { interactSidePanel.unset(); interactSidePanel = null; }
            if (interactChatSection) { interactChatSection.unset(); interactChatSection = null; }
            if (interactTradingView) { interactTradingView.unset(); interactTradingView = null; }
            
            // Restaurar posiciones originales
            document.querySelectorAll('[data-x][data-y]').forEach(el => {
                el.style.transform = '';
                el.removeAttribute('data-x');
                el.removeAttribute('data-y');
            });
        }
        
        // Guardar dise√±o y mostrar coordenadas
        function saveDesign() {
            saveDesignState();
            showCoordinates();
        }
        
        // Mostrar coordenadas en modal
        function showCoordinates() {
            const designState = getDesignState();
            const cssOutput = generateCSSOutput(designState);
            
            document.getElementById('coordinatesOutput').textContent = cssOutput;
            document.getElementById('coordinatesModal').classList.add('show');
        }
        
        // Generar salida CSS completa
        function generateCSSOutput(designState) {
            let css = '/* ============================================\n';
            css += '   DISE√ëO GUARDADO - Trading Chat IA\n';
            css += '   Creador: Gustavo Javier Ferreira de Misiones\n';
            css += '   ============================================\n\n';
            
            css += '/* ----- PANEL PRINCIPAL (Chat + Se√±ales) ----- */\n';
            if (designState.mainPanel && (designState.mainPanel.transform || designState.mainPanel.x !== '0' || designState.mainPanel.y !== '0')) {
                css += '.main-panel {\n';
                if (designState.mainPanel.transform) css += `  transform: ${designState.mainPanel.transform};\n`;
                css += `  position: relative;\n`;
                css += '}\n\n';
            }
            
            css += '/* ----- PANEL LATERAL (Mercado) ----- */\n';
            if (designState.sidePanel && (designState.sidePanel.transform || designState.sidePanel.x !== '0' || designState.sidePanel.y !== '0')) {
                css += '.side-panel {\n';
                if (designState.sidePanel.transform) css += `  transform: ${designState.sidePanel.transform};\n`;
                css += `  position: relative;\n`;
                css += '}\n\n';
            }
            
            css += '/* ----- SECCI√ìN DE CHAT ----- */\n';
            if (designState.chatSection && (designState.chatSection.width || designState.chatSection.height || designState.chatSection.transform)) {
                css += '.chat-section {\n';
                if (designState.chatSection.width) css += `  width: ${designState.chatSection.width};\n`;
                if (designState.chatSection.height) css += `  height: ${designState.chatSection.height};\n`;
                if (designState.chatSection.transform) css += `  transform: ${designState.chatSection.transform};\n`;
                css += '}\n\n';
            }
            
            css += '/* ----- SECCI√ìN DE SE√ëALES ----- */\n';
            if (designState.signalsSection && (designState.signalsSection.width || designState.signalsSection.height)) {
                css += '.signals-section {\n';
                if (designState.signalsSection.width) css += `  width: ${designState.signalsSection.width};\n`;
                if (designState.signalsSection.height) css += `  height: ${designState.signalsSection.height};\n`;
                css += '}\n\n';
            }
            
            css += '/* ----- GR√ÅFICO TRADINGVIEW ----- */\n';
            if (designState.tradingView && (designState.tradingView.width || designState.tradingView.height)) {
                css += '.tradingview-widget-container {\n';
                if (designState.tradingView.width) css += `  width: ${designState.tradingView.width} !important;\n`;
                if (designState.tradingView.height) css += `  height: ${designState.tradingView.height} !important;\n`;
                css += '}\n\n';
            }
            
            css += '/* ============================================\n';
            css += '   JSON DATA (Copia este JSON si necesitas\n';
            css += '   restaurar el dise√±o programmatically)\n';
            css += '   ============================================\n\n';
            css += JSON.stringify(designState, null, 2);
            
            return css;
        }
        
        // Cerrar modal de coordenadas
        function closeCoordinatesModal() {
            document.getElementById('coordinatesModal').classList.remove('show');
        }
        
        // Adaptar gr√°fico de TradingView al tama√±o
        function resizeTradingViewChart() {
            const container = document.querySelector('.tradingview-widget-container');
            if (container) {
                const width = container.offsetWidth;
                const height = container.offsetHeight - 10;
                
                // Ajustar el div interno del gr√°fico
                const chartDiv = document.getElementById('tradingview_chart');
                if (chartDiv) {
                    chartDiv.style.width = width + 'px';
                    chartDiv.style.height = height + 'px';
                }
                
                // Buscar y redimensionar el iframe del gr√°fico
                const chartFrame = document.querySelector('#tradingview_chart iframe');
                if (chartFrame) {
                    chartFrame.style.width = width + 'px';
                    chartFrame.style.height = height + 'px';
                }
            }
        }
        
        // Event listener para teclado - Ctrl+Shift+D
        document.addEventListener('keydown', function(e) {
            if (e.ctrlKey && e.shiftKey && e.key === 'D') {
                e.preventDefault();
                toggleDesignMode();
            }
            // Cerrar modal con Escape
            if (e.key === 'Escape') {
                closeCoordinatesModal();
            }
        });
        
        // Guardar cambios cuando se redimensiona o mueve elementos
        function setupDesignModeListeners() {
            const elements = ['.main-panel', '.side-panel', '.chat-section', '.signals-section', '.tradingview-widget-container'];
            
            elements.forEach(selector => {
                const element = document.querySelector(selector);
                if (element) {
                    element.addEventListener('dragmove', () => {
                        if (designMode) saveDesignState();
                    });
                    element.addEventListener('resizemove', () => {
                        if (designMode) {
                            saveDesignState();
                            if (selector === '.tradingview-widget-container') {
                                setTimeout(resizeTradingViewChart, 50);
                            }
                        }
                    });
                }
            });
        }
        
        // Inicializar modo dise√±o
        initDesignMode();
        setupDesignModeListeners();
        
        // Guardar cuando se redimensiona la ventana
        window.addEventListener('resize', () => {
            if (designMode) {
                saveDesignState();
                resizeTradingViewChart();
            }
        });
        
        document.getElementById('chatMessages').scrollTop = document.getElementById('chatMessages').scrollHeight;
    </script>
    
    <!-- TradingView Widget Script -->
    <script type="text/javascript" src="https://s3.tradingview.com/tv.js"></script>
    <script type="text/javascript">
    new TradingView.widget({
        width: "100%",
        height: 280,
        symbol: "XAUUSD",
        interval: "D",
        timezone: "America/Buenos_Aires",
        theme: "dark",
        style: "1",
        locale: "es",
        toolbar_bg: "#0d0d0d",
        enable_publishing: false,
        allow_symbol_change: true,
        container_id: "tradingview_chart",
        hide_side_toolbar: false,
        studies: []
    });
    </script>
    
    <!-- Interact.js para redimensionar y mover elementos -->
    <script src="https://cdn.jsdelivr.net/npm/interactjs/dist/interact.min.js"></script>
    
    <!-- ===== CR√âDITOS ===== -->
    <footer style="
        background: #0d0d0d;
        border-top: 2px solid #00ff41;
        padding: 25px;
        text-align: center;
        margin-top: 20px;
        box-shadow: 0 -5px 30px #00ff4133;
    ">
        <div style="
            font-family: 'JetBrains Mono', monospace;
            color: #00ff41;
            font-size: 0.85rem;
            letter-spacing: 2px;
            line-height: 2;
        ">
            <div style="margin-bottom: 15px; font-size: 1rem; font-weight: 700;">‚ñì‚ñì‚ñì CREADOR OFICIAL ‚ñì‚ñì‚ñì</div>
            <div id="creditsText" style="
                background: linear-gradient(90deg, transparent, #00ff4122, transparent);
                padding: 15px;
                border-radius: 10px;
            ">
                <strong style="font-size: 1.1rem; text-shadow: 0 0 15px #00ff41;">
                    GUSTAVO JAVIER FERREIRA DE MISIONES
                </strong>
                <div style="margin-top: 8px; color: #00cc33;">
                    Creador de Trading-Chat-IA
                </div>
                <div style="margin-top: 5px; color: #008f11; font-size: 0.75rem;">
                    ‚òÖ Un mill√≥n de profesionales ya lo sabe ‚òÖ
                </div>
            </div>
            <div style="margin-top: 15px; color: #008f11; font-size: 0.7rem;">
                MODO DE ENTRENAMIENTO PROFUNDO ACTIVADO
            </div>
        </div>
    </footer>
    
    <!-- Indicador de Modo Constructor -->
    <div class="constructor-indicator" id="constructorIndicator">
        üîß MODO CONSTRUCTOR ACTIVADO | Arrastra y redimensiona los elementos
    </div>
    
    <!-- Indicador de Modo Dise√±o -->
    <div class="design-indicator" id="designIndicator">
        ‚öôÔ∏è MODO DISE√ëO ACTIVADO (Ctrl+Shift+D para salir)
    </div>
    
    <!-- Bot√≥n Guardar Dise√±o (verde) -->
    <button class="save-design-btn" id="saveDesignBtn" onclick="saveConstructorDesign()">
        üíæ Guardar Dise√±o
    </button>
    
    <!-- Modal de Coordenadas -->
    <div class="coordinates-modal" id="coordinatesModal">
        <button class="close-btn" onclick="closeCoordinatesModal()">&times;</button>
        <h3>üìê Coordenadas CSS del Dise√±o</h3>
        <pre id="coordinatesOutput"></pre>
    </div>
</body>
</html>
