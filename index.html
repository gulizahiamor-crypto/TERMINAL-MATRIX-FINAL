<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trading-Chat-IA | Sistema de Trading Inteligente</title>
    <style>
        /* ===== ESTILO MATRIX/CYBERPUNK ===== */
        @import url('https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;700&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        :root {
            --neon-green: #00ff41;
            --neon-green-dim: #00ff4133;
            --dark-bg: #0a0a0a;
            --panel-bg: #0d0d0d;
            --text-primary: #00ff41;
            --text-secondary: #00cc33;
            --text-muted: #008f11;
            --buy-color: #00ff41;
            --sell-color: #ff0040;
            --border-glow: 0 0 10px var(--neon-green), 0 0 20px var(--neon-green-dim);
        }
        
        /* Tema: Blanco y Negro */
        body.theme-bw {
            --neon-green: #000000;
            --neon-green-dim: #00000033;
            --dark-bg: #ffffff;
            --panel-bg: #f0f0f0;
            --text-primary: #000000;
            --text-secondary: #333333;
            --text-muted: #666666;
            --buy-color: #000000;
            --sell-color: #ff0000;
            --border-glow: none;
        }
        
        /* Tema: Oscuro */
        body.theme-dark {
            --neon-green: #4a9eff;
            --neon-green-dim: #4a9eff33;
            --dark-bg: #1a1a2e;
            --panel-bg: #16213e;
            --text-primary: #4a9eff;
            --text-secondary: #3d8ae6;
            --text-muted: #2a6bc4;
            --buy-color: #00ff88;
            --sell-color: #ff4a6a;
            --border-glow: 0 0 10px #4a9eff, 0 0 20px #4a9eff33;
        }
        
        /* Tema: Claro */
        body.theme-light {
            --neon-green: #0066cc;
            --neon-green-dim: #0066cc33;
            --dark-bg: #ffffff;
            --panel-bg: #f5f5f5;
            --text-primary: #000000;
            --text-secondary: #333333;
            --text-muted: #666666;
            --buy-color: #008800;
            --sell-color: #cc0000;
            --border-glow: none;
        }
        
        /* Tema: Neon Night */
        body.theme-neon {
            --neon-green: #00ffff;
            --neon-green-dim: #00ffff33;
            --dark-bg: #0a001a;
            --panel-bg: #15002a;
            --text-primary: #00ffff;
            --text-secondary: #ff00ff;
            --text-muted: #ff00ff;
            --buy-color: #00ffff;
            --sell-color: #ff00ff;
            --border-glow: 0 0 10px #00ffff, 0 0 20px #ff00ff;
        }
        
        /* Eliminar fondo matrix en temas diferentes */
        body.theme-bw::before, body.theme-dark::before, body.theme-light::before, body.theme-neon::before {
            display: none;
        }
        
        body {
            font-family: 'JetBrains Mono', monospace;
            background-color: var(--dark-bg);
            color: var(--text-primary);
            min-height: 100vh;
            overflow-x: hidden;
        }
        
        /* Efecto de fondo Matrix */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                linear-gradient(90deg, transparent 98%, var(--neon-green-dim) 100%),
                linear-gradient(0deg, transparent 98%, var(--neon-green-dim) 100%);
            background-size: 50px 50px;
            pointer-events: none;
            z-index: -1;
            opacity: 0.3;
        }
        
        /* ===== LAYOUT PRINCIPAL ===== */
        .container {
            display: grid;
            grid-template-columns: 1fr 350px;
            grid-template-rows: auto auto 1fr;
            min-height: 100vh;
            gap: 0;
        }
        
        /* ===== HEADER ===== */
        header {
            grid-column: 1 / -1;
            background: var(--panel-bg);
            border-bottom: 1px solid var(--text-primary);
            padding: 15px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: var(--border-glow);
        }
        
        .logo {
            font-size: 1.5rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 3px;
            text-shadow: var(--border-glow);
        }
        
        .logo span {
            color: var(--text-muted);
        }
        
        /* ===== PANEL DE AJUSTES ===== */
        .settings-panel {
            grid-column: 1 / -1;
            background: var(--panel-bg);
            border-bottom: 1px solid var(--text-muted);
            padding: 10px 30px;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 30px;
            flex-wrap: wrap;
        }
        
        .settings-group {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .settings-label {
            font-size: 0.75rem;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .settings-select {
            background: var(--dark-bg);
            border: 1px solid var(--text-muted);
            color: var(--text-primary);
            padding: 8px 12px;
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.8rem;
            cursor: pointer;
            min-width: 150px;
        }
        
        .settings-select:focus {
            outline: none;
            border-color: var(--text-primary);
        }
        
        .language-search {
            background: var(--dark-bg);
            border: 1px solid var(--text-muted);
            color: var(--text-primary);
            padding: 8px 12px;
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.8rem;
            width: 200px;
        }
        
        .language-search:focus {
            outline: none;
            border-color: var(--text-primary);
        }
        
        .status-indicator {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 0.8rem;
        }
        
        .status-dot {
            width: 10px;
            height: 10px;
            background: var(--neon-green);
            border-radius: 50%;
            animation: pulse 2s infinite;
            box-shadow: 0 0 10px var(--neon-green);
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        /* ===== PANEL PRINCIPAL (CHAT + SEÑALES) ===== */
        .main-panel {
            display: flex;
            flex-direction: column;
            border-right: 1px solid var(--text-primary);
        }
        
        /* ===== ÁREA DE CHAT ===== */
        .chat-section {
            flex: 1;
            display: flex;
            flex-direction: column;
            padding: 20px;
            border-bottom: 1px solid var(--text-primary);
            min-height: 50vh;
        }
        
        .section-title {
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 2px;
            margin-bottom: 15px;
            color: var(--text-secondary);
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .section-title::before {
            content: '>';
            color: var(--text-primary);
        }
        
        .chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 15px;
            background: rgba(0, 0, 0, 0.5);
            border: 1px solid var(--text-muted);
            margin-bottom: 15px;
        }
        
        .message {
            margin-bottom: 15px;
            padding: 10px 15px;
            border-left: 2px solid var(--text-muted);
            animation: fadeIn 0.3s ease;
        }
        
        .message.user {
            border-left-color: var(--text-secondary);
            background: rgba(0, 255, 65, 0.05);
        }
        
        .message.ai {
            border-left-color: var(--text-primary);
            background: rgba(0, 255, 65, 0.1);
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .message-time {
            font-size: 0.7rem;
            color: var(--text-muted);
            margin-bottom: 5px;
        }
        
        .message-content {
            font-size: 0.9rem;
            line-height: 1.6;
        }
        
        .chat-input-area {
            display: flex;
            gap: 10px;
        }
        
        #chatInput {
            flex: 1;
            background: var(--panel-bg);
            border: 1px solid var(--text-muted);
            color: var(--text-primary);
            padding: 12px 15px;
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.9rem;
            outline: none;
            transition: all 0.3s;
        }
        
        #chatInput:focus {
            border-color: var(--text-primary);
            box-shadow: var(--border-glow);
        }
        
        #chatInput::placeholder {
            color: var(--text-muted);
        }
        
        .btn {
            background: transparent;
            border: 1px solid var(--text-primary);
            color: var(--text-primary);
            padding: 12px 20px;
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.8rem;
            cursor: pointer;
            text-transform: uppercase;
            letter-spacing: 1px;
            transition: all 0.3s;
        }
        
        .btn:hover {
            background: var(--neon-green);
            color: var(--dark-bg);
            box-shadow: var(--border-glow);
        }
        
        /* ===== ÁREA DE SEÑALES ===== */
        .signals-section {
            padding: 20px;
            min-height: 300px;
        }
        
        .signal-card {
            background: var(--panel-bg);
            border: 1px solid var(--text-muted);
            padding: 15px;
            margin-bottom: 10px;
            position: relative;
            overflow: hidden;
        }
        
        .signal-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 3px;
            height: 100%;
        }
        
        .signal-card.buy::before {
            background: var(--buy-color);
            box-shadow: 0 0 10px var(--buy-color);
        }
        
        .signal-card.sell::before {
            background: var(--sell-color);
            box-shadow: 0 0 10px var(--sell-color);
        }
        
        .signal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .signal-type {
            font-size: 1.2rem;
            font-weight: 700;
            letter-spacing: 2px;
        }
        
        .signal-type.buy { color: var(--buy-color); }
        .signal-type.sell { color: var(--sell-color); }
        
        .signal-pair {
            font-size: 0.8rem;
            color: var(--text-muted);
        }
        
        .signal-details {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            font-size: 0.75rem;
        }
        
        .signal-detail {
            padding: 8px;
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid var(--text-muted);
        }
        
        .signal-detail-label {
            color: var(--text-muted);
            margin-bottom: 3px;
        }
        
        .signal-detail-value {
            color: var(--text-primary);
        }
        
        .signal-time {
            font-size: 0.7rem;
            color: var(--text-muted);
            margin-top: 10px;
            text-align: right;
        }
        
        .generate-btn {
            width: 100%;
            margin-top: 15px;
        }
        
        /* ===== PANEL LATERAL (DATOS DE MERCADO) ===== */
        .side-panel {
            background: var(--panel-bg);
            padding: 20px;
            overflow-y: auto;
        }
        
        .market-data {
            margin-top: 20px;
        }
        
        .market-item {
            padding: 12px;
            border: 1px solid var(--text-muted);
            margin-bottom: 8px;
            font-size: 0.8rem;
        }
        
        .market-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
        }
        
        .market-pair {
            font-weight: 700;
            color: var(--text-primary);
        }
        
        .market-price {
            font-size: 1.1rem;
            font-weight: 700;
        }
        
        .market-price.up { color: var(--buy-color); }
        .market-price.down { color: var(--sell-color); }
        
        .market-change {
            font-size: 0.75rem;
        }
        
        .market-change.positive { color: var(--buy-color); }
        .market-change.negative { color: var(--sell-color); }
        
        .market-stats {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 5px;
            margin-top: 8px;
            font-size: 0.7rem;
        }
        
        .market-stat {
            color: var(--text-muted);
        }
        
        .market-stat span {
            color: var(--text-secondary);
        }
        
        .tick-container {
            margin-top: 20px;
            padding: 10px;
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid var(--text-muted);
            max-height: 200px;
            overflow-y: auto;
        }
        
        .tick-title {
            font-size: 0.7rem;
            color: var(--text-muted);
            margin-bottom: 10px;
            text-transform: uppercase;
        }
        
        .tick-item {
            font-size: 0.7rem;
            padding: 3px 0;
            border-bottom: 1px dotted var(--text-muted);
            display: flex;
            justify-content: space-between;
        }
        
        .tick-item span:last-child {
            color: var(--text-secondary);
        }
        
        /* ===== SCROLLBAR ===== */
        ::-webkit-scrollbar {
            width: 5px;
        }
        
        ::-webkit-scrollbar-track {
            background: var(--dark-bg);
        }
        
        ::-webkit-scrollbar-thumb {
            background: var(--text-muted);
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: var(--text-primary);
        }
        
        /* ===== RESPONSIVE ===== */
        @media (max-width: 900px) {
            .container {
                grid-template-columns: 1fr;
                grid-template-rows: auto 1fr auto;
            }
            
            .side-panel {
                border-top: 1px solid var(--text-primary);
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- HEADER -->
        <header>
            <div class="logo">Trading<span>-Chat</span>-IA</div>
            <div class="status-indicator">
                <div class="status-dot"></div>
                <span id="statusText">SISTEMA ACTIVO | MODO ONLINE</span>
            </div>
        </header>
        
        <!-- PANEL DE AJUSTES -->
        <div class="settings-panel">
            <div class="settings-group">
                <span class="settings-label">Tema:</span>
                <select class="settings-select" id="themeSelect" onchange="changeTheme()">
                    <option value="matrix">Matrix (Predeterminado)</option>
                    <option value="bw">Blanco y Negro</option>
                    <option value="dark">Oscuro (Dark Mode)</option>
                    <option value="light">Claro (Light Mode)</option>
                    <option value="neon">Neon Night</option>
                </select>
            </div>
            <div class="settings-group">
                <span class="settings-label">Idioma:</span>
                <input type="text" class="language-search" id="languageSearch" placeholder="Buscar idioma..." oninput="filterLanguages()">
                <select class="settings-select" id="languageSelect" onchange="changeLanguage()">
                    <option value="es">Español</option>
                    <option value="en">English</option>
                    <option value="pt">Português</option>
                    <option value="fr">Français</option>
                    <option value="de">Deutsch</option>
                    <option value="it">Italiano</option>
                    <option value="ru">Русский</option>
                    <option value="zh">中文</option>
                    <option value="ja">日本語</option>
                    <option value="ko">한국어</option>
                    <option value="ar">العربية</option>
                    <option value="hi">हिन्दी</option>
                    <option value="tr">Türkçe</option>
                    <option value="pl">Polski</option>
                    <option value="nl">Nederlands</option>
                    <option value="sv">Svenska</option>
                    <option value="da">Dansk</option>
                    <option value="fi">Suomi</option>
                    <option value="no">Norsk</option>
                    <option value="cs">Čeština</option>
                    <option value="el">Ελληνικά</option>
                    <option value="he">עברית</option>
                    <option value="th">ไทย</option>
                    <option value="vi">Tiếng Việt</option>
                    <option value="id">Bahasa Indonesia</option>
                    <option value="ms">Bahasa Melayu</option>
                    <option value="tl">Tagalog</option>
                    <option value="uk">Українська</option>
                    <option value="hu">Magyar</option>
                    <option value="ro">Română</option>
                    <option value="bg">Български</option>
                    <option value="sk">Slovenčina</option>
                    <option value="hr">Hrvatski</option>
                    <option value="sr">Српски</option>
                    <option value="lt">Lietuvių</option>
                    <option value="lv">Latviešu</option>
                    <option value="et">Eesti</option>
                    <option value="sl">Slovenščina</option>
                    <option value="is">Íslenska</option>
                    <option value="ca">Català</option>
                    <option value="eu">Euskara</option>
                    <option value="gl">Galego</option>
                    <option value="af">Afrikaans</option>
                    <option value="sw">Kiswahili</option>
                    <option value="ml">മലയാളം</option>
                    <option value="ta">தமிழ்</option>
                    <option value="te">తెలుగు</option>
                    <option value="bn">বাংলা</option>
                    <option value="pa">ਪੰਜਾਬੀ</option>
                    <option value="gu">ગુજરાતી</option>
                    <option name="kn">ಕನ್ನಡ</option>
                    <option value="mr">मराठी</option>
                    <option value="ne">नेपाली</option>
                    <option value="si">සිංහල</option>
                    <option value="km">ខ្មែរ</option>
                    <option value="lo">ລາວ</option>
                    <option value="my">မြန်မာ</option>
                    <option value="ka">ქართული</option>
                    <option value="am">አማርኛ</option>
                    <option value="ha">Hausa</option>
                    <option value="yo">Yorùbá</option>
                    <option value="zu">Zulu</option>
                </select>
            </div>
        </div>
        
        <!-- PANEL PRINCIPAL -->
        <div class="main-panel">
            <!-- CHAT SECTION -->
            <div class="chat-section">
                <div class="section-title" id="chatTitle">Asistente de IA Universal</div>
                <div class="chat-messages" id="chatMessages">
                    <div class="message ai">
                        <div class="message-time">Sistema</div>
                        <div class="message-content">
                            ▓▓▓ CONEXIÓN ESTABLECIDA ▓▓▓<br><br>
                            Bienvenido al Sistema de IA Universal v1.0<br>
                            Motor de conocimiento infinito activado.<br><br>
                            Puedo responder sobre cualquier tema del mundo.<br>
                            Pregúntame lo que quieras.
                        </div>
                    </div>
                </div>
                <div class="chat-input-area">
                    <input type="text" id="chatInput" placeholder="Pregúntame lo que quieras sobre el mundo..." autocomplete="off">
                    <button class="btn" onclick="sendMessage()">Enviar</button>
                </div>
            </div>
            
            <!-- SEÑALES SECTION -->
            <div class="signals-section">
                <div class="section-title" id="signalsTitle">Generador de Señales</div>
                <div id="signalsContainer">
                    <!-- Las señales se generarán aquí -->
                </div>
                <button class="btn generate-btn" onclick="generateSignal()">Generar Señal</button>
            </div>
        </div>
        
        <!-- PANEL LATERAL -->
        <div class="side-panel">
            <div class="section-title" id="marketTitle">Mercado XAUUSD</div>
            
            <!-- TradingView Widget -->
            <div class="tradingview-widget-container" style="height:280px;margin-bottom:10px;">
                <div id="tradingview_chart"></div>
            </div>
            
            <div class="market-data" id="marketData">
                <!-- Datos del mercado se actualizan aquí -->
            </div>
            
            <div class="tick-container">
                <div class="tick-title" id="tickTitle">Flujo de Ticks en Vivo</div>
                <div id="tickFeed">
                    <!-- Ticks se muestran aquí -->
                </div>
            </div>
        </div>
    </div>

    <script>
        // ===== FUNCIONES DE TEMA =====
        function changeTheme() {
            const theme = document.getElementById('themeSelect').value;
            document.body.className = '';
            if (theme !== 'matrix') {
                document.body.classList.add('theme-' + theme);
            }
            localStorage.setItem('trading-chat-theme', theme);
        }
        
        // Cargar tema guardado
        const savedTheme = localStorage.getItem('trading-chat-theme');
        if (savedTheme && savedTheme !== 'matrix') {
            document.body.classList.add('theme-' + savedTheme);
            document.getElementById('themeSelect').value = savedTheme;
        }
        
        // ===== FUNCIONES DE IDIOMA =====
        let currentLanguage = 'es';
        
        function filterLanguages() {
            const search = document.getElementById('languageSearch').value.toLowerCase();
            const select = document.getElementById('languageSelect');
            const options = select.options;
            
            for (let i = 0; i < options.length; i++) {
                const text = options[i].text.toLowerCase();
                const value = options[i].value.toLowerCase();
                if (text.includes(search) || value.includes(search)) {
                    options[i].style.display = '';
                } else {
                    options[i].style.display = 'none';
                }
            }
        }
        
        function changeLanguage() {
            const lang = document.getElementById('languageSelect').value;
            currentLanguage = lang;
            localStorage.setItem('trading-chat-lang', lang);
            updateInterface();
        }
        
        // Cargar idioma guardado
        const savedLang = localStorage.getItem('trading-chat-lang');
        if (savedLang) {
            document.getElementById('languageSelect').value = savedLang;
            currentLanguage = savedLang;
        }
        
        // ===== TRADUCCIONES DE INTERFAZ =====
        const translations = {
            es: {
                title: 'Asistente de IA Universal',
                inputPlaceholder: 'Pregúntame lo que quieras sobre el mundo...',
                sendBtn: 'Enviar',
                signalsTitle: 'Generador de Señales',
                generateBtn: 'Generar Señal',
                marketTitle: 'Mercado XAUUSD',
                tickTitle: 'Flujo de Ticks en Vivo',
                statusText: 'SISTEMA ACTIVO | MODO ONLINE',
                credits: 'Desarrollado por Ferreira Gustavo Javier, IA sencilla desde casa por un menor de edad'
            },
            en: {
                title: 'Universal AI Assistant',
                inputPlaceholder: 'Ask me anything about the world...',
                sendBtn: 'Send',
                signalsTitle: 'Signal Generator',
                generateBtn: 'Generate Signal',
                marketTitle: 'XAUUSD Market',
                tickTitle: 'Live Tick Flow',
                statusText: 'SYSTEM ACTIVE | ONLINE MODE',
                credits: 'Developed by Ferreira Gustavo Javier, simple AI from home by a minor'
            },
            pt: {
                title: 'Assistente de IA Universal',
                inputPlaceholder: 'Pergunte-me qualquer coisa sobre o mundo...',
                sendBtn: 'Enviar',
                signalsTitle: 'Gerador de Sinais',
                generateBtn: 'Gerar Sinal',
                marketTitle: 'Mercado XAUUSD',
                tickTitle: 'Fluxo de Ticks ao Vivo',
                statusText: 'SISTEMA ATIVO | MODO ONLINE',
                credits: 'Desenvolvido por Ferreira Gustavo Javier, IA simples de casa por menor de idade'
            },
            fr: {
                title: 'Assistant IA Universel',
                inputPlaceholder: 'Demandez-moi tout sur le monde...',
                sendBtn: 'Envoyer',
                signalsTitle: 'Générateur de Signaux',
                generateBtn: 'Générer un Signal',
                marketTitle: 'Marché XAUUSD',
                tickTitle: 'Flux de Ticks en Direct',
                statusText: 'SYSTÈME ACTIF | MODE EN LIGNE',
                credits: 'Développé par Ferreira Gustavo Javier, IA simple à la maison par un mineur'
            },
            de: {
                title: 'Universaler KI-Assistent',
                inputPlaceholder: 'Frage mich alles über die Welt...',
                sendBtn: 'Senden',
                signalsTitle: 'Signalgenerator',
                generateBtn: 'Signal Generieren',
                marketTitle: 'XAUUSD Markt',
                tickTitle: 'Live Tick-Fluss',
                statusText: 'SYSTEM AKTIV | ONLINE-MODUS',
                credits: 'Entwickelt von Ferreira Gustavo Javier, einfache KI von zu Hause durch einen Minderjährigen'
            }
        };
        
        // Función para actualizar la interfaz
        function updateInterface() {
            const t = translations[currentLanguage] || translations.es;
            
            // Chat
            const chatTitle = document.getElementById('chatTitle');
            if (chatTitle) chatTitle.textContent = t.title;
            
            const chatInput = document.getElementById('chatInput');
            if (chatInput) chatInput.placeholder = t.inputPlaceholder;
            
            // Signals
            const signalsTitle = document.getElementById('signalsTitle');
            if (signalsTitle) signalsTitle.textContent = t.signalsTitle;
            
            const genBtn = document.querySelector('.generate-btn');
            if (genBtn) genBtn.textContent = t.generateBtn;
            
            // Market
            const marketTitle = document.getElementById('marketTitle');
            if (marketTitle) marketTitle.textContent = t.marketTitle;
            
            const tickTitle = document.getElementById('tickTitle');
            if (tickTitle) tickTitle.textContent = t.tickTitle;
            
            // Status header
            const statusText = document.getElementById('statusText');
            if (statusText) statusText.textContent = t.statusText;
            
            // Credits
            const creditsEl = document.getElementById('creditsText');
            if (creditsEl) creditsEl.textContent = t.credits;
        }
        
        // Inicializar interfaz
        updateInterface();
        
        // ===== CONFIGURACIÓN API =====
        const API_URL = '/api/chat';

        // ===== BASE DE DATOS DE ESTRATEGIAS =====
        const tradingStrategies = {
            SMC: {
                name: "Smart Money Concepts",
                concepts: [
                    "Order Blocks - Zonas de acumulación institucional",
                    "Fair Value Gap - Espacios vacíos entre movimientos",
                    "Liquidity Sweeps - Barridos de liquidez",
                    "Change of Character - Cambio de estructura",
                    "Break of Structure - Ruptura de estructura"
                ],
                responses: [
                    "Según SMC, el precio está buscando liquidez antes de continuar.",
                    "El concepto de Smart Money indica que los grandes participantes están acumulando.",
                    "La estructura muestra un cambio de carácter.",
                    "Los liquidity sweeps indican que el mercado está buscando órdenes de stop."
                ]
            },
            ICT: {
                name: "Inner Circle Trading",
                concepts: [
                    "Market Structure Shift - MSS",
                    "Optimal Trade Entry - OTE",
                    "Stop Hunt / Stop Run",
                    "Daily/Weekly Highs/Lows",
                    "Fibonacci confluences"
                ],
                responses: [
                    "En ICT, busca el Optimal Trade Entry.",
                    "El Market Structure Shift ha ocurrido.",
                    "Los institucionales están corriendo los stops.",
                    "La mejor configuración es esperar el fair value gap."
                ]
            },
            PriceAction: {
                name: "Price Action",
                concepts: [
                    "Engulfing Patterns",
                    "Doji and Pin Bars",
                    "Inside Bars",
                    "Trend Lines and Channels",
                    "Support and Resistance"
                ],
                responses: [
                    "El price action muestra un posible engulfing.",
                    "Un pin bar en zona de soporte indica reversa potencial.",
                    "El inside bar sugiere consolidación.",
                    "El precio está respetando las líneas de tendencia."
                ]
            }
        };

        // ===== SIMULATE AI RESPONSE =====
        function simulateAIResponse(prompt) {
            const lowerPrompt = prompt.toLowerCase();
            let responses = [
                "He analizado tu consulta. Como IA de conocimiento universal, puedo ayudarte con cualquier tema.",
                "Gracias por tu pregunta. Estoy listo para responder sobre cualquier tema que necesites.",
                "Interesante consulta. Como IA avanzada, tengo conocimiento sobre muchos temas del mundo."
            ];
            
            // Detectar el tipo de consulta
            if (lowerPrompt.includes('estrategia') || lowerPrompt.includes('trading') || lowerPrompt.includes('mercado')) {
                responses = [
                    "Para una operación exitosa, considera: 1) Identifica la estructura del mercado, 2) Busca zonas de liquidez, 3) Gestiona tu riesgo.",
                    "Basándome en SMC e ICT, el mercado muestra señales de acumulación institucional.",
                    "Implementa esta metodología: 1) Define la tendencia, 2) Identifica zonas clave, 3) Espera confirmación."
                ];
            }
            
            return responses[Math.floor(Math.random() * responses.length)];
        }

        // Send to Serverless Function
        async function sendToGemini(prompt) {
            try {
                const response = await fetch(API_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        message: 'Responde exclusivamente en ' + currentLanguage + '. No uses inglés a menos que el usuario lo pida. ' + prompt,
                        language: currentLanguage
                    })
                });
                
                if (!response.ok) {
                    throw new Error('HTTP error: ' + response.status);
                }
                
                const data = await response.json();
                return data.response;
            } catch (error) {
                console.error('Error en API:', error);
                return '[ERROR] Fallo de conexión: ' + error.message;
            }
        }

        // ===== CHAT FUNCTIONALITY =====
        async function sendMessage() {
            const input = document.getElementById('chatInput');
            const message = input.value.trim();
            
            if (!message) return;
            
            // Add user message
            addMessage(message, 'user');
            input.value = '';
            
            // Show loading message
            const loadingDiv = document.createElement('div');
            loadingDiv.className = 'message ai';
            loadingDiv.id = 'loadingMessage';
            loadingDiv.innerHTML = `
                <div class="message-time">IA | Procesando...</div>
                <div class="message-content">▓▓▓ Analizando...</div>
            `;
            document.getElementById('chatMessages').appendChild(loadingDiv);
            document.getElementById('chatMessages').scrollTop = document.getElementById('chatMessages').scrollHeight;
            
            try {
                const response = await sendToGemini(message);
                
                const loadingMsg = document.getElementById('loadingMessage');
                if (loadingMsg) loadingMsg.remove();
                
                addMessage(response, 'ai');
            } catch (error) {
                const loadingMsg = document.getElementById('loadingMessage');
                if (loadingMsg) loadingMsg.remove();
                
                const fallbackResponse = simulateAIResponse(message);
                addMessage(fallbackResponse + '\n\n[NOTA: API no disponible, usando modo offline]', 'ai');
            }
        }

        function addMessage(content, type) {
            const messagesContainer = document.getElementById('chatMessages');
            const time = new Date().toLocaleTimeString('es-AR', { hour: '2-digit', minute: '2-digit' });
            
            const messageDiv = document.createElement('div');
            messageDiv.className = 'message ' + type;
            messageDiv.innerHTML = `
                <div class="message-time">${type === 'user' ? 'Usuario' : 'IA'} | ${time}</div>
                <div class="message-content">${content}</div>
            `;
            
            messagesContainer.appendChild(messageDiv);
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }

        // Enter key to send
        document.getElementById('chatInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                sendMessage();
            }
        });

        // ===== SIGNAL GENERATOR =====
        function generateSignal() {
            const signals = ['BUY', 'SELL'];
            const signal = signals[Math.floor(Math.random() * signals.length)];
            
            const basePrice = 2650.00;
            const variation = (Math.random() - 0.5) * 50;
            const price = (basePrice + variation).toFixed(2);
            
            const entry = (parseFloat(price) + (signal === 'BUY' ? -5 : 5)).toFixed(2);
            const stopLoss = (parseFloat(price) + (signal === 'BUY' ? -25 : 25)).toFixed(2);
            const takeProfit = (parseFloat(price) + (signal === 'BUY' ? 40 : -40)).toFixed(2);
            
            const timeframes = ['M15', 'H1', 'H4', 'D1'];
            const timeframe = timeframes[Math.floor(Math.random() * timeframes.length)];
            const confidence = Math.floor(70 + Math.random() * 25);
            
            const strategyKeys = Object.keys(tradingStrategies);
            const strategyKey = strategyKeys[Math.floor(Math.random() * strategyKeys.length)];
            const strategy = tradingStrategies[strategyKey];
            const concept = strategy.concepts[Math.floor(Math.random() * strategy.concepts.length)];
            
            const time = new Date().toLocaleTimeString('es-AR', { hour: '2-digit', minute: '2-digit', second: '2-digit' });
            
            const signalCard = document.createElement('div');
            signalCard.className = 'signal-card ' + signal.toLowerCase();
            signalCard.innerHTML = `
                <div class="signal-header">
                    <span class="signal-type ${signal.toLowerCase()}">◄ ${signal} ►</span>
                    <span class="signal-pair">XAUUSD</span>
                </div>
                <div class="signal-details">
                    <div class="signal-detail">
                        <div class="signal-detail-label">Entrada</div>
                        <div class="signal-detail-value">${entry}</div>
                    </div>
                    <div class="signal-detail">
                        <div class="signal-detail-label">Stop Loss</div>
                        <div class="signal-detail-value">${stopLoss}</div>
                    </div>
                    <div class="signal-detail">
                        <div class="signal-detail-label">Take Profit</div>
                        <div class="signal-detail-value">${takeProfit}</div>
                    </div>
                </div>
                <div class="signal-details" style="margin-top: 8px;">
                    <div class="signal-detail">
                        <div class="signal-detail-label">Timeframe</div>
                        <div class="signal-detail-value">${timeframe}</div>
                    </div>
                    <div class="signal-detail">
                        <div class="signal-detail-label">Confianza</div>
                        <div class="signal-detail-value">${confidence}%</div>
                    </div>
                    <div class="signal-detail">
                        <div class="signal-detail-label">Estrategia</div>
                        <div class="signal-detail-value">${strategyKey}</div>
                    </div>
                </div>
                <div style="margin-top: 10px; padding: 8px; background: rgba(0,0,0,0.3); border: 1px solid var(--text-muted); font-size: 0.7rem;">
                    ${concept}
                </div>
                <div class="signal-time">${time}</div>
            `;
            
            const container = document.getElementById('signalsContainer');
            container.insertBefore(signalCard, container.firstChild);
            
            while (container.children.length > 5) {
                container.removeChild(container.lastChild);
            }
        }

        // ===== MARKET DATA SIMULATION =====
        let currentPrice = 2650.00;
        
        function updateMarketData() {
            const change = (Math.random() - 0.5) * 2;
            currentPrice += change;
            
            const priceFormatted = currentPrice.toFixed(2);
            const changeValue = change.toFixed(2);
            const changePercent = ((change / currentPrice) * 100).toFixed(3);
            const isUp = change >= 0;
            
            const high = (currentPrice + Math.random() * 20).toFixed(2);
            const low = (currentPrice - Math.random() * 20).toFixed(2);
            const volume = Math.floor(100000 + Math.random() * 50000);
            
            const marketData = document.getElementById('marketData');
            if (marketData) {
                marketData.innerHTML = `
                    <div class="market-item">
                        <div class="market-header">
                            <span class="market-pair">XAU/USD</span>
                            <span class="market-price ${isUp ? 'up' : 'down'}">${priceFormatted}</span>
                        </div>
                        <div class="market-change ${isUp ? 'positive' : 'negative'}">
                            ${isUp ? '▲' : '▼'} ${changeValue} (${changePercent}%)
                        </div>
                        <div class="market-stats">
                            <div class="market-stat">Alto: <span>${high}</span></div>
                            <div class="market-stat">Bajo: <span>${low}</span></div>
                            <div class="market-stat">Volumen: <span>${volume.toLocaleString()}</span></div>
                            <div class="market-stat">Spread: <span>${(Math.random() * 0.5 + 0.2).toFixed(1)}</span></div>
                        </div>
                    </div>
                `;
            }
        }

        // ===== TICK FEED =====
        function addTick() {
            const tickValue = (currentPrice + (Math.random() - 0.5) * 0.5).toFixed(2);
            const time = new Date().toLocaleTimeString('es-AR', { hour: '2-digit', minute: '2-digit', second: '2-digit' });
            
            const tickFeed = document.getElementById('tickFeed');
            if (tickFeed) {
                const tickItem = document.createElement('div');
                tickItem.className = 'tick-item';
                tickItem.innerHTML = `
                    <span>${time}</span>
                    <span>${tickValue}</span>
                `;
                
                tickFeed.insertBefore(tickItem, tickFeed.firstChild);
                
                while (tickFeed.children.length > 20) {
                    tickFeed.removeChild(tickFeed.lastChild);
                }
            }
        }

        // ===== INITIALIZATION =====
        updateMarketData();
        
        for (let i = 0; i < 10; i++) {
            addTick();
        }
        
        generateSignal();
        
        setInterval(updateMarketData, 2000);
        setInterval(addTick, 500);
        
        document.getElementById('chatMessages').scrollTop = document.getElementById('chatMessages').scrollHeight;
    </script>
    
    <!-- TradingView Widget Script -->
    <script type="text/javascript" src="https://s3.tradingview.com/tv.js"></script>
    <script type="text/javascript">
    new TradingView.widget({
        width: "100%",
        height: 280,
        symbol: "XAUUSD",
        interval: "D",
        timezone: "America/Buenos_Aires",
        theme: "dark",
        style: "1",
        locale: "es",
        toolbar_bg: "#0d0d0d",
        enable_publishing: false,
        allow_symbol_change: true,
        container_id: "tradingview_chart",
        hide_side_toolbar: false,
        studies: []
    });
    </script>
    
    <!-- ===== CRÉDITOS ===== -->
    <footer style="
        background: #0d0d0d;
        border-top: 1px solid #00ff41;
        padding: 20px;
        text-align: center;
        margin-top: 20px;
        box-shadow: 0 0 10px #00ff4133;
    ">
        <div style="
            font-family: 'JetBrains Mono', monospace;
            color: #00ff41;
            font-size: 0.75rem;
            letter-spacing: 1px;
            line-height: 1.8;
        ">
            <div style="margin-bottom: 10px;">▓▓▓ CRÉDITOS DEL SISTEMA ▓▓▓</div>
            <div id="creditsText">Desarrollado por Ferreira Gustavo Javier, IA sencilla desde casa por un menor de edad</div>
            <div style="margin-top: 10px; color: #008f11;">
                MODO DE ENTRENAMIENTO PROFUNDO ACTIVADO
            </div>
        </div>
    </footer>
</body>
</html>
